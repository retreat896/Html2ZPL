<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>V2 Testing</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

    <meta name="description" content="">
    <meta name="author" content="html blank">
    <meta name="generator" content="Plain html plus a bit of bootstrap">

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>


    <style>
        :root {
            --nav-height: 40px;
            --nav-bg-color: rgba(0, 0, 0, 0.1);
            --nav-margin: 0px;
            --nav-padding: 10px;


            --text-color: white;
            /*IF --nav-padding is less than 20 dont add it to the calculation*/
            --content-height: calc(100vh - (var(--nav-height) + var(--nav-margin)));

            --left-container-width: 200px;
            --left-container-height: var(--content-height);
            --left-container-bg-color: rgba(0, 0, 0, 0.1);

            --editor-bg-color: rgba(0, 0, 0, 0.4);


            --right-container-width: 200px;
            --right-container-height: var(--content-height);
            --right-container-bg-color: rgba(0, 0, 0, 0.1);

            --inner-margin: 10px;
            --inner-height: calc(100vh - (var(--inner-margin)*2) - var(--nav-height) - var(--nav-margin));
            --inner-border-radius: 8px;
            --inner-bg-color: rgba(0, 0, 0, 0.1);
            --inner-closed-width: 50px
        }

        #page {
            display: flex;
            flex-direction: column;
            width: 100vw;
            height: 100vh;
        }

        #nav {
            display: flex;
            flex-direction: row;
            width: 100%;
            max-width: 100vw;
            height: var(--nav-height);
            background-color: var(--nav-bg-color);
            padding: var(--nav-padding);
            margin: var(--nav-margin);
            max-height: var(--nav-height);
        }

        #content {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            justify-content: normal;
            align-items: normal;
            align-content: normal;
            width: 100%;
            max-width: 100vw;
            height: 100%;
            color: var(--text-color);
        }

        #left {
            display: block;
            width: var(--left-container-width);
            border: 1px solid black;
            position: absolute;
            left: 0px;
            height: var(--left-container-height);
            background-color: var(--left-container-bg-color);
            pointer-events: none;
        }

        #editor {
            display: flex;
            margin: 0px;
            width: 100%;
            border: 1px solid black;
            justify-content: center;
            background-color: var(--editor-bg-color);
        }

        #right {
            display: block;
            width: var(--right-container-width);
            height: var(--right-container-height);
            border: 1px solid black;
            position: absolute;
            right: 0px;
            background-color: var(--right-container-bg-color);
            pointer-events: none;
        }

        #innerEditorCanvas {

            max-height: var(--content-height);
            pointer-events: all;
        }

        .inner {
            pointer-events: all;
            height: var(--inner-height);

            margin: var(--inner-margin);
            border-radius: var(--inner-border-radius);
            background-color: var(--inner-bg-color);
            transition: width .4s ease;
            width: calc(var(--left-container-width) - (var(--inner-margin) * 2));
            overflow: hidden;
            position: inherit;
            right: inherit;
            left: inherit;
        }

        .inner.closed {

            width: var(--inner-closed-width);
        }

        #innerEditorCanvas {

            max-height: var(--content-height);
            pointer-events: all;
        }
    </style>

</head>

<body>
    <script>
        
		document.addEventListener("DOMContentLoaded", function(e) {
			// Canvas
			var mouseDown = false;
			var mousePos = [0, 0];
			var canvas = document.querySelector("#innerEditorCanvas");
            canvas.width = document.querySelector("#editor").clientWidth;
            canvas.height = document.querySelector("#editor").clientHeight - 10;

			var context = canvas.getContext("2d");
			canvas.addEventListener("mousewheel", zoom, false);
			canvas.addEventListener("mousedown", setMouseDown, false);
			canvas.addEventListener("mouseup", setMouseUp, false);
			canvas.addEventListener("mousemove", move, false);

			// Defaults
			var DEFAULT_ZOOM = .5;
			var MAX_ZOOM = 3;
			var MIN_ZOOM = .2;
			var ZOOM_STEP = .1;
			var DRAW_POS = [canvas.width/2, canvas.height/2];

			// Buttons
			var zoomInBtn = document.querySelector("#zoomIn");
			zoomInBtn.addEventListener("click", zoomIn, false);
			var zoomOutBtn = document.querySelector("#zoomOut");
			zoomOutBtn.addEventListener("click", zoomOut, false);
			var resetZoomBtn = document.querySelector("#resetZoom");
			resetZoomBtn.addEventListener("click", resetZoom, false);
			var resetPosBtn = document.querySelector("#resetPos");
			resetPosBtn.addEventListener("click", resetPos, false);

			// Image
			var loaded = false;
			var drawPos = DRAW_POS;
			var scale = DEFAULT_ZOOM;
			var image = new Image();
			image.src = "./image.jpg";
			image.addEventListener("load", function(e) {
				loaded = true;
				requestAnimationFrame(drawCanvas);
			}, false);

			// Draw the canvas
			function drawCanvas() {
				context.fillStyle = "#FFFFFF";
				context.fillRect(0,0,canvas.width,canvas.height);
				if (loaded) {
					drawImage();
				}
                requestAnimationFrame(drawCanvas);
			}

			// Draw the image
			function drawImage() {
				var w = image.width * scale;
				var h = image.height * scale;
				
				var x = drawPos[0] - (w / 2);
				var y = drawPos[1] - (h / 2);
				context.drawImage(image, x, y, w, h);
			}
			
			// Set the zoom with the mouse wheel
			function zoom(e) {
				if (e.wheelDelta > 0) {
					zoomIn();
				}
				else {
					zoomOut();
				}
			}

			// Zoom in
			function zoomIn(e) {
				if (scale < MAX_ZOOM) {
					scale += ZOOM_STEP;
					drawCanvas();
				}
			}

			// Zoom out
			function zoomOut(e) {
				if (scale > MIN_ZOOM) {
					scale -= ZOOM_STEP;
					drawCanvas();
				}
			}

			// Reset the zoom
			function resetZoom(e) {
				scale = DEFAULT_ZOOM;
				drawCanvas();
			}

			// Reset the position
			function resetPos(e) {
				drawPos = DRAW_POS;
				drawCanvas();
			}

			// Toggle mouse status
			function setMouseDown(e) {
				mouseDown = true;
				mousePos = [e.x, e.y];
                $(".inner").css("pointer-events", "none");
			}
			function setMouseUp(e) {
				mouseDown = false;
                $(".inner").css("pointer-events", "all");
			}

			// Move
			function move(e) {
				if (mouseDown) {
					
					var delta = [e.x - mousePos[0], e.y - mousePos[1]];
					drawPos = [drawPos[0] + delta[0], drawPos[1] + delta[1]];
					mousePos = [e.x, e.y];
					drawCanvas();
				}
			}

		}, true);
	
    </script>
    

    <script type="text/javascript">

        $(document).ready(function () {

        })

        function toggleThis(element) {
            element.toggleClass('closed');
        }

    </script>
    <div id="page">
        <div id="nav">
            nav
        </div>

        <div id="content">
            <div id="left">
                <div class="inner closed">left<button onclick="toggleThis($(this).closest('.inner'))">Toggle</button>
                    <p>Zoom:
                        <button type="button" id="zoomIn">Zoom In (+)</button>
                        <button type="button" id="zoomOut">Zoom Out (-)</button>
                        <button type="button" id="resetZoom">Reset Zoom</button>
                    </p>
                </div>
            </div>
            <div id="editor">
                <div id="innerEditor"><canvas id="innerEditorCanvas"></canvas></div>
            </div>
            <div id="right">
                <div class="inner closed">right<button onclick="toggleThis($(this).closest('.inner'))">Toggle</button>
                    <p>Click and drag to move the image. <button type="button" id="resetPos">Reset Position</button></p>
                </div>
            </div>
        </div>
    </div>



</body>

</html>